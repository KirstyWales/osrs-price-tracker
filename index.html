<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OSRS Herb Yield Tracker</title>
<style>
  body {
    background: #111;
    color: #eee;
    font-family: sans-serif;
    padding: 20px;
    max-width: 900px;
    margin: auto;
  }
  h1, h2 {
    margin-bottom: 10px;
  }
  input, select {
    padding: 10px;
    margin: 5px 0;
    width: 100%;
    font-size: 1rem;
    border-radius: 6px;
    border: none;
    outline: none;
  }
  label {
    margin-top: 10px;
    display: block;
  }
  .result-box {
    background: #222;
    border-radius: 6px;
    padding: 10px;
    margin-top: 15px;
  }
</style>
</head>
<body>
<h1>OSRS Herb Yield Estimator</h1>
<form id="herbForm">
  <label for="herb">Select Herb Type:</label>
  <select id="herb">
    <option value="ranarr">Ranarr (Lvl 32)</option>
    <option value="toadflax">Toadflax (Lvl 38)</option>
    <option value="snapdragon">Snapdragon (Lvl 62)</option>
    <!-- Add more as needed -->
  </select>

  <label for="level">Farming Level:</label>
  <input type="number" id="level" value="85" min="1" max="120" />

  <label for="compost">Compost Type:</label>
  <select id="compost">
    <option value="3">Ultracompost</option>
    <option value="2">Supercompost</option>
    <option value="1">Compost</option>
    <option value="0">None</option>
  </select>

  <label><input type="checkbox" id="secateurs" /> Magic Secateurs</label>
  <label><input type="checkbox" id="cape" /> Farming Cape</label>
  <label><input type="checkbox" id="attas" /> Attas Plant Active</label>
  <label><input type="checkbox" id="diary10" /> +10 Kandarin Diary Boost</label>
  <label><input type="checkbox" id="diary17" /> +17 Kandarin Diary Boost</label>
  <label><input type="checkbox" id="diary25" /> +25 Kandarin Diary Boost</label>

  <button type="submit">Calculate Expected Yield</button>
</form>
<div id="result" class="result-box"></div>

<script>
const HERB_CTSlow = {
  ranarr: 45,
  toadflax: 40,
  snapdragon: 50
};
const CTShigh = 80;

function applyBoosts(cts, secateurs, cape, attas, diary) {
  let bonus = 0;
  if (secateurs) bonus += 0.1;
  if (cape) bonus += 0.05;
  cts = Math.floor(cts * (1 + bonus));
  cts += diary;
  if (attas) cts = Math.floor(cts * 1.05);
  return cts;
}

function calcChanceToSave(ctSlow, level, ctHigh) {
  const save = 1 + Math.floor((ctSlow * (99 - level) + ctHigh * (level - 1) + 49) / 98);
  return save / 256;
}

function expectedYield(lives, p) {
  return Math.round(lives / (1 - p));
}

document.getElementById("herbForm").addEventListener("submit", function(e) {
  e.preventDefault();

  const herb = document.getElementById("herb").value;
  const level = parseInt(document.getElementById("level").value);
  const compost = parseInt(document.getElementById("compost").value);
  const lives = 3 + compost;

  const secateurs = document.getElementById("secateurs").checked;
  const cape = document.getElementById("cape").checked;
  const attas = document.getElementById("attas").checked;
  let diaryBoost = 0;
  if (document.getElementById("diary25").checked) diaryBoost = 25;
  else if (document.getElementById("diary17").checked) diaryBoost = 17;
  else if (document.getElementById("diary10").checked) diaryBoost = 10;

  const rawCTSlow = HERB_CTSlow[herb];
  const boostedLow = applyBoosts(rawCTSlow, secateurs, cape, attas, diaryBoost);
  const boostedHigh = applyBoosts(CTShigh, secateurs, cape, attas, diaryBoost);

  const saveChance = calcChanceToSave(boostedLow, level, boostedHigh);
  const yieldEst = expectedYield(lives, saveChance);

  document.getElementById("result").innerHTML = `
    <strong>Estimated Yield:</strong> ${yieldEst} herbs per patch<br />
    <strong>Chance to Save Life:</strong> ${(saveChance * 100).toFixed(2)}%
  `;
});
</script>
</body>
</html>
